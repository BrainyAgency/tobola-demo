<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Jeu de S√©lection</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* --- BASE & TYPOGRAPHIE --- */
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at top, #1b2735 0%, #090a0f 100%);
  color: #ecf0f1;
  text-align: center;
  min-height: 100vh;
}

/* --- HEADER (Effet Verre) --- */
header {
  padding: 30px 20px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  border-radius: 0 0 30px 30px;
  margin-bottom: 30px;
}

h1 {
  font-weight: 800;
  letter-spacing: 2px;
  text-transform: uppercase;
  background: linear-gradient(to right, #ffffff, #a5b4fc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin: 0 0 10px 0;
  text-shadow: 0 0 20px rgba(165, 180, 252, 0.3);
}

p {
  font-weight: 300;
  color: #bdc3c7;
  font-size: 0.95rem;
  max-width: 600px;
  margin: 0 auto 20px auto;
}

/* --- BOUTONS GENERAUX --- */
button {
  padding: 12px 25px;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  font-family: 'Poppins', sans-serif;
  font-size: 1rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}

button:active {
  transform: scale(0.95);
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  filter: grayscale(100%);
}

/* --- BOUTON PAYER (Gold Premium) --- */
#payBtn {
  background: linear-gradient(135deg, #FFD700 0%, #FDB931 50%, #C49204 100%);
  color: #000;
  font-weight: 800;
  text-transform: uppercase;
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
  margin-bottom: 25px;
  border: 2px solid #fff;
}

#payBtn:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 30px rgba(255, 215, 0, 0.7);
}

/* --- GRILLE DES NUMEROS --- */
#numbers {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(65px, 1fr));
  gap: 15px;
  max-width: 900px;
  margin: 0 auto;
  padding: 20px;
}

/* --- BOUTONS NUMEROS (Style Boule 3D) --- */
.numBtn {
  background: linear-gradient(145deg, #1abc9c, #16a085);
  color: #fff;
  font-weight: 700;
  font-size: 1.2rem;
  aspect-ratio: 1;
  border-radius: 50%;
  box-shadow: inset 2px 2px 5px rgba(255,255,255,0.3), 
              0 5px 15px rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
}

.numBtn:hover {
  transform: translateY(-5px) scale(1.1);
  background: linear-gradient(145deg, #2ecc71, #27ae60);
  box-shadow: 0 10px 20px rgba(46, 204, 113, 0.4);
  z-index: 10;
}

.numBtn.taken {
  background: #2c3e50;
  color: #5d6d7e;
  box-shadow: inset 0 0 10px #000;
  border: 1px solid #34495e;
}

/* --- MODALS (POPUP) --- */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(5px);
  justify-content: center;
  align-items: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: #fff;
  color: #2c3e50;
  padding: 30px;
  border-radius: 20px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
  animation: slideUp 0.3s ease;
  position: relative;
}

.modal-content h3 {
  margin-top: 0;
  color: #2c3e50;
  text-transform: uppercase;
  border-bottom: 2px solid #ffd700;
  display: inline-block;
  padding-bottom: 5px;
}

/* --- INPUTS --- */
input {
  padding: 12px 15px;
  margin: 10px 0;
  width: 100%;
  box-sizing: border-box;
  border-radius: 10px;
  border: 2px solid #ecf0f1;
  background: #f9f9f9;
  font-family: 'Poppins', sans-serif;
  font-size: 1rem;
  transition: 0.3s;
}

input:focus {
  outline: none;
  border-color: #1abc9c;
  background: #fff;
  box-shadow: 0 0 10px rgba(26, 188, 156, 0.2);
}

.modal-content button {
  width: 100%;
  margin-top: 10px;
  background: #2c3e50;
  color: #fff;
}
.modal-content button:first-of-type {
  background: #1abc9c;
}
.modal-content button:hover {
  opacity: 0.9;
}

/* --- OFFLINE BLOCK --- */
#offlineBlock {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(192, 57, 43, 0.95);
  color: #fff;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: bold;
  z-index: 9999;
}

/* --- ADMIN BUTTON --- */
#adminBtn {
  background: transparent;
  border: 1px solid rgba(231, 76, 60, 0.5);
  color: #e74c3c;
  font-size: 0.8rem;
  margin: 40px auto;
  opacity: 0.7;
}
#adminBtn:hover {
  background: #e74c3c;
  color: #fff;
  opacity: 1;
}

/* --- ADMIN SECTION --- */
#admin {
  display: none; /* cach√©e par d√©faut */
  background: #fff;
  color: #333;
  padding: 20px;
  min-height: 100vh;
  text-align: left;
}
#admin h2 { text-align: center; color: #e74c3c; }

table {
  width: 100%;
  margin-top: 20px;
  background: #f4f6f7;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
th { background: #34495e; color: #fff; padding: 12px; }
td { border-bottom: 1px solid #ddd; padding: 10px; color: #333; text-align: center; }
.ticket { 
  background: #16a085; color: #fff; 
  padding: 10px; margin: 5px 0; 
  border-radius: 8px; 
  display: flex; justify-content: space-between; align-items: center; 
}

/* --- ANIMATIONS --- */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

/* --- EFFET PULSANT ET CLIGNOTANT POUR LE NUMERO GAGNANT --- */
@keyframes pulse {
  0% { transform: scale(1); text-shadow: 0 0 10px #ffd700; }
  50% { transform: scale(1.1); text-shadow: 0 0 25px #ffd700, 0 0 50px #ffea00; }
  100% { transform: scale(1); text-shadow: 0 0 10px #ffd700; }
}
.pulse {
  animation: pulse 1s infinite;
}
</style>
</head>

<body>

<div id="offlineBlock">‚ö†Ô∏è Connexion Internet requise</div>

<div id="userInterface">
<header>
  <h1>S.E.A.F  PROMOTION</h1>
  <p>Choisissez votre nombre, tentez votre chance et devenez le grand gagnant</p>
  
  <button id="payBtn">üí≥ Acheter un ticket</button>

  <div id="publicWinner" style="font-size:2rem; margin-top:20px; color:#ffd700; font-weight:800; text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);"></div>
</header>

<div id="numbers"></div>

<button id="adminBtn" onclick="adminPopup.style.display='flex'">üîí</button>
</div>

<div class="modal" id="popup">
  <div class="modal-content">
    <h3>Valider ma participation</h3>
    <input id="nameInput" placeholder="Nom complet">
    <input id="phoneInput" placeholder="Num√©ro de t√©l√©phone" type="tel">
    <input id="ticketInput" placeholder="Code du ticket">
    <button onclick="submitPlay()">Confirmer</button>
    <button onclick="closePopup()" style="background:#e74c3c;">Annuler</button>
  </div>
</div>

<div class="modal" id="adminPopup">
  <div class="modal-content">
    <h3>ESPACE ADMINISTRATION</h3>
    <input id="adminNum" placeholder="Identifiant Admin">
    <input id="adminCode" placeholder="Mot de passe" type="password">
    <button onclick="validateAdmin()">Connexion</button>
    <button onclick="closeAdmin()" style="background:#95a5a6;">Retour</button>
  </div>
</div>

<div class="modal" id="infoPopup">
  <div class="modal-content">
    <h3 style="border:none;">Information</h3>
    <p id="infoText" style="color:#333; font-weight:500;"></p>
    <button onclick="closeInfo()">Compris</button>
  </div>
</div>

<div class="modal" id="confirmPopup">
  <div class="modal-content">
    <h3 style="border-color:#e74c3c;">Attention</h3>
    <p id="confirmText" style="color:#333;"></p>
    <button onclick="confirmYes()" style="background:#e74c3c;">Oui, confirmer</button>
    <button onclick="confirmNo()" style="background:#95a5a6;">Non, annuler</button>
  </div>
</div>

<section id="admin">
<div style="max-width:800px; margin:auto;">
  <h2>üõ† Tableau de Bord</h2>
  <button onclick="window.location.reload()" style="background:#34495e; margin-bottom:20px;">üö™ Quitter / Retour Site</button>
  <hr style="opacity:0.2">

  <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-bottom:20px;">
    <button onclick="generateTicket()" style="background:#2980b9;">‚ûï Nouveau Ticket</button>
    <button onclick="toggleTickets()" style="background:#8e44ad;">üé´ Voir Tickets</button>
    <button onclick="askReset()" style="background:#c0392b;">‚ôªÔ∏è TOUT R√âINITIALISER</button>
  </div>

  <div id="tickets" style="display:none; background:#ecf0f1; padding:15px; border-radius:10px; margin-bottom:20px;"></div>

  <div style="background:#fdfefe; padding:20px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.05); margin-bottom:30px;">
    <h3>üèÜ D√©signer le Gagnant</h3>
    <div style="display:flex; gap:10px;">
      <input id="winNumber" type="number" min="0" max="50" placeholder="N¬∞ Gagnant" style="margin:0;">
      <button onclick="selectWinner()" style="margin:0; width:auto;">Valider</button>
    </div>
    <div id="winner" style="margin-top:15px; font-weight:bold; color:#27ae60;"></div>
  </div>

  <h3>üìä Liste des Participants</h3>
  <div style="overflow-x:auto;">
    <table>
    <thead><tr><th>Nom</th><th>T√©l</th><th>N¬∞ Choisi</th><th>Code Ticket</th></tr></thead>
    <tbody id="players"></tbody>
    </table>
  </div>
</div>
</section>

<script>

/* üîä SONS */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function playSound(freq=400,dur=0.12){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=freq;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+dur);
  o.stop(audioCtx.currentTime+dur);
}

/* INFO POPUP */
function showInfo(msg){
  playSound(600);
  infoText.innerText=msg;
  infoPopup.style.display="flex";
}
function closeInfo(){infoPopup.style.display="none"}

/* CONFIRM RESET */
let confirmAction=null;
function askReset(){
  playSound(300);
  confirmText.innerText="Confirmer la r√©initialisation du jeu ?";
  confirmAction=resetGame;
  confirmPopup.style.display="flex";
}
function confirmYes(){
  playSound(700);
  confirmPopup.style.display="none";
  confirmAction&&confirmAction();
}
function confirmNo(){
  playSound(200);
  confirmPopup.style.display="none";
}

/* INTERNET */
function checkInternet(){
  offlineBlock.style.display=navigator.onLine?"none":"flex";
}
window.addEventListener("online",checkInternet);
window.addEventListener("offline",checkInternet);
checkInternet();

/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyAmhpsSUM7kVuRRwLvn2b8U94dNW9YW0jo",
  authDomain:"ppojet-4f3df.firebaseapp.com",
  projectId:"ppojet-4f3df"
});
const db=firebase.firestore();

let selectedNumber=null;

/* NUMBERS */
const numbersDiv=document.getElementById("numbers");
const buttons={};
for(let i=0;i<=50;i++){
  const b=document.createElement("button");
  b.textContent=i;
  b.className="numBtn";
  b.onclick=()=>{playSound();openPopup(i)};
  numbersDiv.appendChild(b);
  buttons[i]=b;
}

function updateButtons(){
  db.collection("plays").onSnapshot(s=>{
    Object.values(buttons).forEach(b=>{b.disabled=false;b.classList.remove("taken")});
    s.forEach(d=>{
      buttons[d.data().number].disabled=true;
      buttons[d.data().number].classList.add("taken");
    });
  });
}
updateButtons();

function openPopup(n){
  if(buttons[n].disabled) return;
  selectedNumber=n;
  popup.style.display="flex";
}
function closePopup(){popup.style.display="none"}

/* SUBMIT */
function submitPlay(){
  playSound();
  const name=nameInput.value.trim();
  const phone=phoneInput.value.trim();
  const ticket=ticketInput.value.trim();
  if(!name||!phone||!ticket) return showInfo("Tous les champs sont obligatoires");

  db.collection("tickets").doc(ticket).get().then(d=>{
    if(!d.exists||d.data().used) return showInfo("Ticket invalide");
    db.collection("plays").add({name,phone,number:selectedNumber,ticket});
    db.collection("tickets").doc(ticket).update({used:true});
    showInfo("Participation valid√©e");
    popup.style.display="none";
  });
}

/* BOUTON PAYER TICKET => WHATSAPP */
payBtn.onclick=()=>{
  window.open("https://wa.me/22898371280?text=Je%20veux%20payer%20le%20ticket","_blank");
};

/* ADMIN POPUP */
function validateAdmin(){
  playSound(500);
  if(adminNum.value==="98371280"&&adminCode.value==="963689"){
    adminPopup.style.display="none";
    userInterface.style.display="none";
    admin.style.display="block";
  }else showInfo("Acc√®s refus√©");
}
function closeAdmin(){adminPopup.style.display="none"}

/* ADMIN ACTIONS */
function generateTicket(){
  playSound(600);
  const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let t="";
  for(let i=0;i<4;i++) t+=chars[Math.floor(Math.random()*chars.length)];
  db.collection("tickets").doc(t).set({used:false});
  showInfo("Ticket g√©n√©r√© : "+t);
}

function toggleTickets(){
  playSound();
  tickets.style.display=tickets.style.display==="none"?"block":"none";
}

db.collection("tickets").onSnapshot(s=>{
  tickets.innerHTML="";
  s.forEach(d=>{
    if(!d.data().used){
      tickets.innerHTML+=`<div class="ticket"><b>${d.id}</b>
      <button onclick="playSound();navigator.clipboard.writeText('${d.id}')" style="background:#fff;color:#16a085;padding:5px 10px;font-size:0.8rem;">Copier</button></div>`;
    }
  });
});

/* SELECTION GAGNANT */
function selectWinner(){
  playSound(700);
  const n=Number(winNumber.value);

  db.collection("config").doc("winner").set({number:n});

  // BLOQUER TOUS LES BOUTONS SAUF LE GAGNANT
  Object.keys(buttons).forEach(key=>{
    if(Number(key)!==n){
      buttons[key].disabled=true;
      buttons[key].classList.add("taken");
    } else {
      buttons[key].disabled=false;
      buttons[key].classList.remove("taken");
    }
  });

  db.collection("plays").where("number","==",n).get().then(s=>{
    if(!s.empty){
      const d=s.docs[0].data();
      winner.innerHTML=`üèÜ ${d.name} (${d.phone})`;
    }else{
      winner.innerHTML="Aucun joueur pour ce num√©ro";
    }
  });
}

/* RESET */
function resetGame(){
  db.collection("plays").get().then(s=>s.forEach(d=>d.ref.delete()));
  db.collection("config").doc("winner").delete();
  Object.values(buttons).forEach(b=>{
    b.disabled=false;
    b.classList.remove("taken");
  });
  publicWinner.innerHTML="";
  publicWinner.classList.remove("pulse");
  showInfo("Jeu r√©initialis√©");
}

/* LISTE JOUEURS */
db.collection("plays").onSnapshot(s=>{
  players.innerHTML="";
  s.forEach(d=>{
    const p=d.data();
    players.innerHTML+=`<tr><td>${p.name}</td><td>${p.phone}</td><td>${p.number}</td><td>${p.ticket}</td></tr>`;
  });
});

/* AFFICHAGE PUBLIC GAGNANT */
db.collection("config").doc("winner").onSnapshot(doc=>{
  if(doc.exists){
    const n=doc.data().number;
    publicWinner.innerHTML="üéâ GAGNANT : N¬∞ "+n;
    publicWinner.classList.add("pulse");
    Object.keys(buttons).forEach(key=>{
      if(Number(key)!==n){
        buttons[key].disabled=true;
        buttons[key].classList.add("taken");
      } else {
        buttons[key].disabled=false;
        buttons[key].classList.remove("taken");
      }
    });
  }else{
    publicWinner.innerHTML="";
    publicWinner.classList.remove("pulse");
  }
});

</script>
</body>
</html>
